/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2025 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include<stdio.h>


#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

void delay(void){
	for(uint32_t i=0 ; i <= 300000;i++);
}

int main(void)
{
	uint32_t volatile *const clkCtrlReg = 	   (uint32_t*)0x40023830;
	uint32_t volatile *const gpioDModeReg =   (uint32_t*)0x40020C00;
	uint32_t volatile *const gpioDInpReg =    (uint32_t*)0x40020C10;
	uint32_t volatile *const gpioDOpReg =     (uint32_t*)0x40020C14;
	uint32_t volatile *const gpioDPullUpReg = (uint32_t*)0x40020C0C;



	*clkCtrlReg |= (0x1 << 3);

	// setting input and output pin for rows(Output) and column(input)
	*gpioDModeReg &= ~(0xFF); 				// reset the bit
	*gpioDModeReg |=(0x55);		  			// setting as input for Columns (0-3) pins

	*gpioDModeReg &= ~(0xFF << 16);			// clearing the bits
	//*gpioDModeReg |= (0x00 << 16);		// setting as output for rows (8-11)pins

	// setting pull-Up register
	*gpioDPullUpReg |=(0x55 << 16);		 	// setting up pull up register for input to supress noise from the keypad



    /* Loop forever */
	while(1){
		*gpioDOpReg |= 0xF;				// makeing all rows high
		*gpioDOpReg &= ~(0x1 << 0);		// setting 0th pin low rest all are high

		if(*gpioDInpReg & (1 << 8)) {
			delay();
			printf("Pressed 1");
		}
		if(*gpioDInpReg & (1 << 9)) {
			delay();
			printf("Pressed 2");
		}
		if(*gpioDInpReg & (1 << 10)){
			 delay();
			 printf("Pressed 3");
		}
		if(*gpioDInpReg & (1 << 11)){
			 delay();
			 printf("Pressed A");
		}

		*gpioDOpReg |= 0xF;				// again making all rows high
		*gpioDOpReg &= ~(0x1 << 1);		// setting 1st pin low remaining are high
		if(*gpioDInpReg & (1 << 8)) {
			delay();
			printf("Pressed 5") ;
		}
		if(*gpioDInpReg & (1 << 9)) {
			delay();
			printf("Pressed 6") ;
		}
		if(*gpioDInpReg & (1 << 10)){
			 delay();
			 printf("Pressed 7") ;
		}
		if(*gpioDInpReg & (1 << 11)){
			delay();
			printf("Pressed B") ;
		}

		*gpioDOpReg |= 0xF;				// again making all rows high
		*gpioDOpReg &= ~(0x1 << 2);		// setting 2nd pin low and rest high
		if(*gpioDInpReg & (1 << 8)) {
			delay();
			printf("Pressed 8") ;
		}
		if(*gpioDInpReg & (1 << 9)) {
			delay();
			printf("Pressed 9") ;
		}
		if(*gpioDInpReg & (1 << 10)){
			delay();
			printf("Pressed 7") ;
		}
		if(*gpioDInpReg & (1 << 11)){
			delay();
			printf("Pressed C") ;
		}

		*gpioDOpReg |= 0xF;				// make all rows high again
		*gpioDOpReg &= ~(0x1 << 3);		// set 3rd pin low
		if(*gpioDInpReg & (1 << 8)) {
			delay();
			printf("Pressed *") ;
		}
		if(*gpioDInpReg & (1 << 9)) {
			delay();
			printf("Pressed 0") ;
		}
		if(*gpioDInpReg & (1 << 10)){
			delay();
			printf("Pressed #") ;
		}
		if(*gpioDInpReg & (1 << 11)){
			delay();
			printf("Pressed D") ;
		}
	}

}
